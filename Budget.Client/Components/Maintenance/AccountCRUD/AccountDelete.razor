@inject IBudgetMaintApiClient MaintApi
@using Budget.Shared.Models

<MudDialog>
  <DialogContent>
    @if (_account is null)
    {
        <MudProgressCircular Indeterminate="true" />
    }
    else
    {
        <MudStack Spacing="2">
            <MudText Typo="Typo.h6">Delete Account</MudText>
            <MudAlert Severity="Severity.Warning" Dense="true">This action cannot be undone.</MudAlert>
            <MudText>Are you sure you want to delete <strong>@_account.Name</strong>?</MudText>
        </MudStack>
    }
  </DialogContent>
  <DialogActions>
      <MudButton Color="Color.Error" Variant="Variant.Filled" OnClick="DeleteAsync" Disabled="@(_account is null)">Delete</MudButton>
      <MudButton Color="Color.Secondary" Variant="Variant.Text" OnClick="Cancel">Cancel</MudButton>
  </DialogActions>
</MudDialog>

@code {
    [Parameter] public int Id { get; set; }
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    private BankAccountDto? _account;

    protected override async Task OnParametersSetAsync()
    {
        var list = await MaintApi.GetAccountsAsync();
        _account = list.FirstOrDefault(a => a.Id == Id);
    }

    private async Task DeleteAsync()
    {
        if (_account is null) return;
        await MaintApi.RemoveAccountAsync(_account.Id);
        MudDialog.Close(DialogResult.Ok(true));
    }

    private void Cancel() => MudDialog.Close(DialogResult.Cancel());
}
