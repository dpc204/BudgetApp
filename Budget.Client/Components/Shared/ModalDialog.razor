@inherits ComponentBase
@if (Visible)
{
    <div class="modal-backdrop" @onclick="HandleBackdrop" />
    <div class="modal-container @CssClass" role="dialog" aria-modal="true" aria-label="@Title">
        <div class="modal-header d-flex justify-content-between align-items-center mb-2">
            <h5 class="modal-title m-0">@Title</h5>
            <button type="button" class="btn-close" aria-label="Close" @onclick="Close"></button>
        </div>
        <div class="modal-body">
            @ChildContent
        </div>
        @if (Footer is not null)
        {
            <div class="modal-footer mt-3">
                @Footer
            </div>
        }
    </div>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public EventCallback<bool> VisibleChanged { get; set; }
    [Parameter] public string Title { get; set; } = string.Empty;
    [Parameter] public string CssClass { get; set; } = string.Empty;
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? Footer { get; set; }
    [Parameter] public bool CloseOnBackdrop { get; set; } = true;

    private async Task Close()
    {
        if (Visible)
        {
            Visible = false;
            await VisibleChanged.InvokeAsync(false);
        }
    }

    private Task HandleBackdrop(MouseEventArgs _)
        => CloseOnBackdrop ? Close() : Task.CompletedTask;
}

<style>
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:1050; }
.modal-container { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:1rem 1.25rem; border-radius:.3rem; min-width:360px; max-width:640px; z-index:1060; box-shadow:0 0.5rem 1rem rgba(0,0,0,.15);} 
.modal-body { max-height:70vh; overflow:auto; }
.btn-close { background: none; border: none; font-size: 1.1rem; }
/* Utility sizing/consistency for form controls inside modal */
.modal-container .form-control,
.modal-container .form-select,
.modal-container input[type=text],
.modal-container input[type=number],
.modal-container textarea { width:100%; box-sizing:border-box; }
.modal-container .form-control, .modal-container .form-select { min-height:2.35rem; }
.modal-container .mb-2, .modal-container .mb-3 { margin-bottom:0.85rem !important; }
</style>
